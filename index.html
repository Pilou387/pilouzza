<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pizza Maison - Commande</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .pizza-icon {
            font-size: 60px;
            margin-bottom: 20px;
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2a5298;
        }

        input[type="text"], input[type="password"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }

        input[type="text"]:focus, input[type="password"]:focus {
            outline: none;
            border-color: #2a5298;
            transform: scale(1.02);
        }

        .choice-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .choice-option {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
            position: relative;
        }

        .choice-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .choice-option.selected {
            background: #2a5298;
            color: white;
            border-color: #2a5298;
            transform: scale(1.05);
        }

        .ingredient-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .ingredient-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 8px;
            transition: all 0.3s;
            position: relative;
        }

        .ingredient-item:hover {
            background: #e8e8e8;
        }

        .ingredient-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            cursor: pointer;
        }

        .ingredient-item label {
            cursor: pointer;
            margin-bottom: 0;
            font-weight: normal;
            flex: 1;
        }

        .info-btn {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #2a5298;
            color: white;
            border: none;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
            margin-left: 5px;
        }

        .info-btn:hover {
            background: #1e3c72;
            transform: scale(1.1);
        }

        .info-tooltip {
            display: none;
            position: fixed;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            max-width: 250px;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .info-tooltip.show {
            display: block;
        }

        .info-tooltip img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .btn-submit, .btn-primary {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #f39c12 0%, #e74c3c 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }

        .btn-submit:hover, .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.4);
        }

        .success-message {
            display: none;
            text-align: center;
            padding: 20px;
            background: #27ae60;
            color: white;
            border-radius: 10px;
            margin-top: 20px;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .admin-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255,255,255,0.9);
            color: #2a5298;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: all 0.3s;
        }

        .admin-toggle:hover {
            transform: scale(1.1);
            background: white;
        }

        .admin-view, .prep-view {
            display: none;
        }

        .order-list {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .order-item {
            background: #f9f9f9;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            border-left: 5px solid #2a5298;
            animation: slideIn 0.3s ease-out;
        }

        .order-item h3 {
            color: #2a5298;
            margin-bottom: 10px;
        }

        .order-detail {
            margin: 5px 0;
            color: #666;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn-secondary {
            background: #2a5298;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-secondary:hover {
            background: #1e3c72;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .order-counter {
            background: #e74c3c;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 14px;
            margin-left: 10px;
        }

        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 0 10px;
        }

        .step {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: #e0e0e0;
            transition: all 0.3s;
        }

        .step.active {
            background: #2a5298;
            transform: scale(1.3);
        }

        .step.completed {
            background: #27ae60;
        }

        .pizza-preview {
            width: 150px;
            height: 150px;
            background: #f5f5f5;
            border-radius: 50%;
            margin: 20px auto;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
        }

        .pizza-layer {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 100px;
            opacity: 0;
            transition: opacity 0.5s;
        }

        .pizza-layer.show {
            opacity: 1;
        }

        .prep-instruction {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 18px;
            border: 2px solid #2a5298;
        }

        .prep-pizza-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .prep-pizza-item {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .prep-pizza-visual {
            width: 80px;
            height: 80px;
            background: #f5f5f5;
            border-radius: 50%;
            margin: 0 auto 10px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
        }

        .hidden {
            display: none;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .choice-grid, .ingredient-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBkpyaebYWwxhLdVGAx8HO2A8_pzHyOk54",
            authDomain: "la-pilouzza.firebaseapp.com",
            projectId: "la-pilouzza",
            storageBucket: "la-pilouzza.firebasestorage.app",
            messagingSenderId: "612459079025",
            appId: "1:612459079025:web:d9c1b059eae189bce142d0"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
    </script>
</head>
<body>
    <div class="container">
        <!-- Vue Commande Client -->
        <div id="orderView" class="order-view">
            <div class="header">
                <div class="pizza-icon">üçï</div>
                <h1>Pizza Maison</h1>
                <p>Composez votre pizza id√©ale !</p>
            </div>

            <div class="step-indicator">
                <div class="step active" data-step="1"></div>
                <div class="step" data-step="2"></div>
                <div class="step" data-step="3"></div>
                <div class="step" data-step="4"></div>
                <div class="step" data-step="5"></div>
                <div class="step" data-step="6"></div>
                <div class="step" data-step="7"></div>
            </div>

            <form id="pizzaForm" class="card">
                <!-- √âtape 1: Nom -->
                <div class="form-step" data-step="1">
                    <div class="form-group">
                        <label for="name">Votre nom</label>
                        <input type="text" id="name" required placeholder="Jean Dupont">
                    </div>
                    <button type="button" class="btn-primary" onclick="nextStep()">Suivant</button>
                </div>

                <!-- √âtape 2: Type de p√¢te -->
                <div class="form-step hidden" data-step="2">
                    <div class="form-group">
                        <label>Type de p√¢te</label>
                        <div class="choice-grid">
                            <div class="choice-option" data-dough="napolitaine">
                                <div>üçï</div>
                                <div>Napolitaine</div>
                            </div>
                            <div class="choice-option" data-dough="sans-gluten">
                                <div>üåæ</div>
                                <div>Sans gluten</div>
                            </div>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn-secondary" onclick="previousStep()">‚Üê Retour</button>
                        <button type="button" class="btn-primary" onclick="nextStep()">Suivant</button>
                    </div>
                </div>

                <!-- √âtape 3: Type de pizza -->
                <div class="form-step hidden" data-step="3">
                    <div class="form-group">
                        <label>Choisissez votre pizza</label>
                        <div class="choice-grid">
                            <div class="choice-option" data-pizza="personnalisee">
                                <div>‚ú®</div>
                                <div>Personnalis√©e</div>
                            </div>
                            <div class="choice-option" data-pizza="margherita">
                                <div>üçÖ</div>
                                <div>Margherita</div>
                            </div>
                            <div class="choice-option" data-pizza="regina">
                                <div>üçñ</div>
                                <div>Regina</div>
                            </div>
                            <div class="choice-option" data-pizza="4fromages">
                                <div>üßÄ</div>
                                <div>4 Fromages</div>
                            </div>
                            <div class="choice-option" data-pizza="calzone">
                                <div>ü•ü</div>
                                <div>Calzone</div>
                            </div>
                            <div class="choice-option" data-pizza="diavola">
                                <div>üå∂Ô∏è</div>
                                <div>Diavola</div>
                            </div>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn-secondary" onclick="previousStep()">‚Üê Retour</button>
                        <button type="button" class="btn-primary" onclick="nextStep()">Suivant</button>
                    </div>
                </div>

                <!-- √âtape 4: Base -->
                <div class="form-step hidden" data-step="4">
                    <div class="form-group">
                        <label>Base de la pizza</label>
                        <div class="choice-grid">
                            <div class="choice-option" data-base="tomate">
                                <div>üçÖ</div>
                                <div>Tomate</div>
                            </div>
                            <div class="choice-option" data-base="creme">
                                <div>ü•õ</div>
                                <div>Cr√®me</div>
                            </div>
                            <div class="choice-option" data-base="pesto">
                                <div>üåø</div>
                                <div>Pesto</div>
                            </div>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn-secondary" onclick="previousStep()">‚Üê Retour</button>
                        <button type="button" class="btn-primary" onclick="nextStep()">Suivant</button>
                    </div>
                </div>

                <!-- √âtape 5: L√©gumes -->
                <div class="form-step hidden" data-step="5">
                    <div class="form-group">
                        <label>L√©gumes</label>
                        <div class="ingredient-grid">
                            <div class="ingredient-item">
                                <input type="checkbox" id="oignons" name="vegetables" value="Oignons">
                                <label for="oignons">üßÖ Oignons</label>
                                <button type="button" class="info-btn" onclick="showInfo('Oignons', 'Bulbe aromatique au go√ªt doux ou piquant', 'oignons rouges')">i</button>
                            </div>
                            <div class="ingredient-item">
                                <input type="checkbox" id="poivrons" name="vegetables" value="Poivrons">
                                <label for="poivrons">ü´ë Poivrons</label>
                                <button type="button" class="info-btn" onclick="showInfo('Poivrons', 'L√©gume color√©, croquant et l√©g√®rement sucr√©', 'poivrons grill√©s pizza')">i</button>
                            </div>
                            <div class="ingredient-item">
                                <input type="checkbox" id="champignons" name="vegetables" value="Champignons">
                                <label for="champignons">üçÑ Champignons</label>
                                <button type="button" class="info-btn" onclick="showInfo('Champignons', 'Champignons de Paris, saveur douce et terreuse', 'champignons de paris')">i</button>
                            </div>
                            <div class="ingredient-item">
                                <input type="checkbox" id="courgettes" name="vegetables" value="Courgettes">
                                <label for="courgettes">ü•í Courgettes</label>
                                <button type="button" class="info-btn" onclick="showInfo('Courgettes', 'L√©gume vert tendre au go√ªt d√©licat', 'courgettes grill√©es')">i</button>
                            </div>
                            <div class="ingredient-item">
                                <input type="checkbox" id="aubergines" name="vegetables" value="Aubergines">
                                <label for="aubergines">üçÜ Aubergines</label>
                                <button type="button" class="info-btn" onclick="showInfo('Aubergines', 'L√©gume violet √† la texture fondante', 'aubergines grill√©es')">i</button>
                            </div>
                            <div class="ingredient-item">
                                <input type="checkbox" id="artichauts" name="vegetables" value="Artichauts">
                                <label for="artichauts">ü•¨ Artichauts</label>
                                <button type="button" class="info-btn" onclick="showInfo('Artichauts', 'C≈ìurs d\'artichauts marin√©s, go√ªt d√©licat', 'coeurs artichauts marin√©s')">i</button>
                            </div>
                            <div class="ingredient-item">
                                <input type="checkbox" id="olives" name="vegetables" value="Olives">
                                <label for="olives">ü´í Olives</label>
                                <button type="button" class="info-btn" onclick="showInfo('Olives', 'Olives noires ou vertes, saveur sal√©e', 'olives noires vertes')">i</button>
                            </div>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn-secondary" onclick="previousStep()">‚Üê Retour</button>
                        <button type="button" class="btn-primary" onclick="nextStep()">Suivant</button>
                    </div>
                </div>

                <!-- √âtape 6: Fromages -->
                <div class="form-step hidden" data-step="6">
                    <div class="form-group">
                        <label>Fromages</label>
                        <div class="ingredient-grid">
                            <div class="ingredient-item">
                                <input type="checkbox" id="mozzarella" name="cheese" value="Mozzarella">
                                <label for="mozzarella">üßÄ Mozzarella</label>
                                <button type="button" class="info-btn" onclick="showInfo('Mozzarella', 'Fromage italien doux et filant', 'mozzarella di bufala')">i</button>
                            </div>
                            <div class="ingredient-item">
                                <input type="checkbox" id="scamorza" name="cheese" value="Scamorza">
                                <label for="scamorza">üßà Scamorza</label>
                                <button type="button" class="info-btn" onclick="showInfo('Scamorza', 'Fromage italien fum√© au go√ªt prononc√©', 'scamorza affumicata')">i</button>
                            </div>
                            <div class="ingredient-item">
                                <input type="checkbox" id="provolone" name="cheese" value="Provolone">
                                <label for="provolone">üßÄ Provolone</label>
                                <button type="button" class="info-btn" onclick="showInfo('Provolone', 'Fromage italien semi-dur au go√ªt piquant', 'provolone cheese')">i</button>
                            </div>
                            <div class="ingredient-item">
                                <input type="checkbox" id="taleggio" name="cheese" value="Taleggio">
                                <label for="taleggio">üßà Taleggio</label>
                                <button type="button" class="info-btn" onclick="showInfo('Taleggio', 'Fromage cr√©meux italien au go√ªt fruit√©', 'taleggio cheese')">i</button>
                            </div>
                            <div class="ingredient-item">
                                <input type="checkbox" id="parmesan" name="cheese" value="Parmesan">
                                <label for="parmesan">üßÄ Parmesan</label>
                                <button type="button" class="info-btn" onclick="showInfo('Parmesan', 'Fromage italien dur au go√ªt intense', 'parmigiano reggiano')">i</button>
                            </div>
                            <div class="ingredient-item">
                                <input type="checkbox" id="gruyere" name="cheese" value="Gruy√®re">
                                <label for="gruyere">üßÄ Gruy√®re</label>
                                <button type="button" class="info-btn" onclick="showInfo('Gruy√®re', 'Fromage suisse au go√ªt fruit√© et noisette', 'gruy√®re cheese')">i</button>
                            </div>
                            <div class="ingredient-item">
                                <input type="checkbox" id="chevre" name="cheese" value="Ch√®vre">
                                <label for="chevre">üêê Ch√®vre</label>
                                <button type="button" class="info-btn" onclick="showInfo('Ch√®vre', 'Fromage de ch√®vre cr√©meux et acidul√©', 'fromage de ch√®vre')">i</button>
                            </div>
                            <div class="ingredient-item">
                                <input type="checkbox" id="fourme" name="cheese" value="Fourme d'Ambert">
                                <label for="fourme">üßÄ Fourme</label>
                                <button type="button" class="info-btn" onclick="showInfo('Fourme d\'Ambert', 'Fromage bleu doux et cr√©meux', 'fourme ambert')">i</button>
                            </div>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn-secondary" onclick="previousStep()">‚Üê Retour</button>
                        <button type="button" class="btn-primary" onclick="nextStep()">Suivant</button>
                    </div>
                </div>

                <!-- √âtape 7: Viandes et Extras -->
                <div class="form-step hidden" data-step="7">
                    <div class="form-group">
                        <label>Viandes</label>
                        <div class="ingredient-grid">
                            <div class="ingredient-item">
                                <input type="checkbox" id="lardons" name="meat" value="Lardons">
                                <label for="lardons">ü•ì Lardons</label>
                                <button type="button" class="info-btn" onclick="showInfo('Lardons', 'Petits morceaux de poitrine fum√©e', 'lardons fum√©s')">i</button>
                            </div>
                            <div class="ingredient-item">
                                <input type="checkbox" id="nduja" name="meat" value="Nduja">
                                <label for="nduja">üå∂Ô∏è Nduja</label>
                                <button type="button" class="info-btn" onclick="showInfo('Nduja', 'Charcuterie calabraise √©pic√©e √† tartiner', 'nduja calabrese')">i</button>
                            </div>
                            <div class="ingredient-item">
                                <input type="checkbox" id="jambonblanc" name="meat" value="Jambon blanc">
                                <label for="jambonblanc">üçñ Jambon blanc</label>
                                <button type="button" class="info-btn" onclick="showInfo('Jambon blanc', 'Jambon cuit classique', 'jambon blanc')">i</button>
                            </div>
                            <div class="ingredient-item">
                                <input type="checkbox" id="jamboncru" name="meat" value="Jambon cru">
                                <label for="jamboncru">ü•© Jambon cru</label>
                                <button type="button" class="info-btn" onclick="showInfo('Jambon cru', 'Jambon sec italien (prosciutto)', 'prosciutto di parma')">i</button>
                            </div>
                        </div>

                        <label style="margin-top: 20px;">Extras</label>
                        <div class="ingredient-grid">
                            <div class="ingredient-item">
                                <input type="checkbox" id="miel" name="extras" value="Miel">
                                <label for="miel">üçØ Miel</label>
                                <button type="button" class="info-btn" onclick="showInfo('Miel', 'Miel liquide pour sucrer l√©g√®rement', 'miel liquide')">i</button>
                            </div>
                            <div class="ingredient-item">
                                <input type="checkbox" id="huilepiquante" name="extras" value="Huile piquante">
                                <label for="huilepiquante">üå∂Ô∏è Huile piquante</label>
                                <button type="button" class="info-btn" onclick="showInfo('Huile piquante', 'Huile d\'olive infus√©e au piment', 'olio piccante')">i</button>
                            </div>
                            <div class="ingredient-item">
                                <input type="checkbox" id="huileolive" name="extras" value="Huile d'olive">
                                <label for="huileolive">ü´í Huile d'olive</label>
                                <button type="button" class="info-btn" onclick="showInfo('Huile d\'olive', 'Huile d\'olive extra vierge', 'huile olive extra vierge')">i</button>
                            </div>
                            <div class="ingredient-item">
                                <input type="checkbox" id="huiletruffe" name="extras" value="Huile de truffe">
                                <label for="huiletruffe">üçÑ Huile de truffe</label>
                                <button type="button" class="info-btn" onclick="showInfo('Huile de truffe', 'Huile parfum√©e √† la truffe noire', 'huile truffe noire')">i</button>
                            </div>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 20px;">
                        <label for="notes">Instructions sp√©ciales</label>
                        <input type="text" id="notes" placeholder="Sans oignons, bien cuite...">
                    </div>

                    <div class="btn-group">
                        <button type="button" class="btn-secondary" onclick="previousStep()">‚Üê Retour</button>
                        <button type="submit" class="btn-submit">Commander ma pizza üçï</button>
                    </div>
                </div>
            </form>

            <div id="successMessage" class="success-message">
                <h2>‚úÖ Commande confirm√©e !</h2>
                <p>Votre pizza sera pr√™te bient√¥t !</p>
            </div>
        </div>

        <!-- Vue Admin -->
        <div id="adminView" class="admin-view">
            <div class="header">
                <h1>Tableau de bord Pizzaiolo</h1>
                <p>Commandes en attente <span id="orderCount" class="order-counter">0</span></p>
            </div>

            <div class="order-list">
                <div class="btn-group">
                    <button class="btn-secondary" onclick="showOrderView()">‚Üê Retour</button>
                    <button class="btn-secondary" onclick="showPrepView()">Mode Pr√©paration üë®‚Äçüç≥</button>
                    <button class="btn-danger" onclick="clearOrders()">Effacer tout</button>
                </div>
                <div id="ordersList"></div>
            </div>
        </div>

        <!-- Vue Pr√©paration -->
        <div id="prepView" class="prep-view">
            <div class="header">
                <h1>Mode Pr√©paration</h1>
                <p>Suivez les √©tapes pour pr√©parer les pizzas</p>
            </div>

            <div class="order-list">
                <div class="btn-group">
                    <button class="btn-secondary" onclick="showAdminView()">‚Üê Retour</button>
                </div>
                <div id="prepContent"></div>
            </div>
        </div>
    </div>

    <!-- Modal de connexion admin -->
    <div id="adminLogin" class="info-tooltip" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); max-width: 350px;">
        <h3 style="margin-bottom: 15px;">Acc√®s Admin</h3>
        <input type="password" id="adminPassword" placeholder="Mot de passe" style="margin-bottom: 15px;">
        <button class="btn-primary" onclick="checkPassword()">Connexion</button>
        <button class="btn-secondary" onclick="cancelLogin()" style="margin-top: 10px;">Annuler</button>
    </div>

    <!-- Tooltip d'information -->
    <div id="infoTooltip" class="info-tooltip"></div>

    <button class="admin-toggle" onclick="requestAdminAccess()">üë®‚Äçüç≥</button>

    <script>
        // Configuration
        const ADMIN_PASSWORD = "pizza123";
        
        // √âtat de l'application
        let currentStep = 1;
        let currentOrder = {};
        let isAdminAuthenticated = false;

        // D√©finition des pizzas pr√©d√©finies
        const predefinedPizzas = {
            margherita: {
                base: 'tomate',
                vegetables: ['Olives'],
                cheese: ['Mozzarella'],
                meat: [],
                extras: ['Huile d\'olive']
            },
            regina: {
                base: 'tomate',
                vegetables: ['Champignons'],
                cheese: ['Mozzarella'],
                meat: ['Jambon blanc'],
                extras: []
            },
            '4fromages': {
                base: 'creme',
                vegetables: [],
                cheese: ['Mozzarella', 'Ch√®vre', 'Fourme d\'Ambert', 'Parmesan'],
                meat: [],
                extras: []
            },
            calzone: {
                base: 'tomate',
                vegetables: ['Champignons'],
                cheese: ['Mozzarella'],
                meat: ['Jambon blanc'],
                extras: []
            },
            diavola: {
                base: 'tomate',
                vegetables: ['Oignons'],
                cheese: ['Mozzarella'],
                meat: ['Nduja'],
                extras: ['Huile piquante']
            }
        };

        // Navigation entre les √©tapes
        function nextStep() {
            if (validateCurrentStep()) {
                document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.add('hidden');
                document.querySelector(`.step[data-step="${currentStep}"]`).classList.remove('active');
                document.querySelector(`.step[data-step="${currentStep}"]`).classList.add('completed');
                
                currentStep++;
                
                document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.remove('hidden');
                document.querySelector(`.step[data-step="${currentStep}"]`).classList.add('active');

                // Si pizza pr√©d√©finie, pr√©-remplir les ingr√©dients
                if (currentStep === 4 && currentOrder.pizzaType !== 'personnalisee') {
                    applyPredefinedPizza();
                }
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.add('hidden');
                document.querySelector(`.step[data-step="${currentStep}"]`).classList.remove('active', 'completed');
                
                currentStep--;
                
                document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.remove('hidden');
                document.querySelector(`.step[data-step="${currentStep}"]`).classList.add('active');
            }
        }

        function validateCurrentStep() {
            switch(currentStep) {
                case 1:
                    const name = document.getElementById('name').value;
                    if (!name) {
                        alert('Veuillez entrer votre nom');
                        return false;
                    }
                    currentOrder.name = name;
                    return true;
                case 2:
                    const dough = document.querySelector('[data-dough].selected');
                    if (!dough) {
                        alert('Veuillez choisir un type de p√¢te');
                        return false;
                    }
                    currentOrder.dough = dough.dataset.dough;
                    return true;
                case 3:
                    const pizza = document.querySelector('[data-pizza].selected');
                    if (!pizza) {
                        alert('Veuillez choisir un type de pizza');
                        return false;
                    }
                    currentOrder.pizzaType = pizza.dataset.pizza;
                    return true;
                case 4:
                    const base = document.querySelector('[data-base].selected');
                    if (!base) {
                        alert('Veuillez choisir une base');
                        return false;
                    }
                    currentOrder.base = base.dataset.base;
                    return true;
                default:
                    return true;
            }
        }

        function applyPredefinedPizza() {
            const pizza = predefinedPizzas[currentOrder.pizzaType];
            if (pizza) {
                // Pr√©-s√©lectionner la base
                document.querySelectorAll('[data-base]').forEach(opt => opt.classList.remove('selected'));
                document.querySelector(`[data-base="${pizza.base}"]`)?.classList.add('selected');
                
                // Pr√©-cocher les ingr√©dients
                document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
                
                pizza.vegetables.forEach(veg => {
                    const checkbox = Array.from(document.querySelectorAll('input[name="vegetables"]'))
                        .find(cb => cb.value === veg);
                    if (checkbox) checkbox.checked = true;
                });
                
                pizza.cheese.forEach(cheese => {
                    const checkbox = Array.from(document.querySelectorAll('input[name="cheese"]'))
                        .find(cb => cb.value === cheese);
                    if (checkbox) checkbox.checked = true;
                });
                
                pizza.meat.forEach(meat => {
                    const checkbox = Array.from(document.querySelectorAll('input[name="meat"]'))
                        .find(cb => cb.value === meat);
                    if (checkbox) checkbox.checked = true;
                });
                
                pizza.extras.forEach(extra => {
                    const checkbox = Array.from(document.querySelectorAll('input[name="extras"]'))
                        .find(cb => cb.value === extra);
                    if (checkbox) checkbox.checked = true;
                });
            }
        }

        // Gestion des s√©lections
        document.querySelectorAll('.choice-option').forEach(option => {
            option.addEventListener('click', function() {
                const siblings = this.parentElement.querySelectorAll('.choice-option');
                siblings.forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
            });
        });

        // Afficher les informations sur les ingr√©dients
        function showInfo(name, description, searchTerm) {
            const tooltip = document.getElementById('infoTooltip');
            const imageUrl = `https://www.google.com/search?q=${encodeURIComponent(searchTerm)}&tbm=isch`;
            
            tooltip.innerHTML = `
                <img src="https://via.placeholder.com/250x150?text=${encodeURIComponent(name)}" alt="${name}">
                <h4>${name}</h4>
                <p>${description}</p>
                <a href="${imageUrl}" target="_blank" style="color: #4CAF50; text-decoration: none;">Voir des images ‚Üí</a>
            `;
            
            tooltip.classList.add('show');
            
            // Positionner le tooltip
            const rect = event.target.getBoundingClientRect();
            tooltip.style.left = rect.left + 'px';
            tooltip.style.top = (rect.bottom + 10) + 'px';
            
            // Cacher apr√®s 5 secondes
            setTimeout(() => {
                tooltip.classList.remove('show');
            }, 5000);
        }

        // Cacher le tooltip en cliquant ailleurs
        document.addEventListener('click', function(e) {
            if (!e.target.classList.contains('info-btn')) {
                document.getElementById('infoTooltip').classList.remove('show');
            }
        });

        // Soumission du formulaire
        document.getElementById('pizzaForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Collecter toutes les donn√©es
            const orderData = {
                name: currentOrder.name,
                dough: currentOrder.dough,
                pizzaType: currentOrder.pizzaType,
                base: currentOrder.base,
                vegetables: Array.from(document.querySelectorAll('input[name="vegetables"]:checked')).map(cb => cb.value),
                cheese: Array.from(document.querySelectorAll('input[name="cheese"]:checked')).map(cb => cb.value),
                meat: Array.from(document.querySelectorAll('input[name="meat"]:checked')).map(cb => cb.value),
                extras: Array.from(document.querySelectorAll('input[name="extras"]:checked')).map(cb => cb.value),
                notes: document.getElementById('notes').value,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                time: new Date().toLocaleTimeString('fr-FR')
            };

            // Enregistrer dans Firebase
            db.collection("orders").add(orderData)
                .then(() => {
                    document.getElementById('successMessage').style.display = 'block';
                    setTimeout(() => {
                        resetForm();
                    }, 3000);
                })
                .catch(error => {
                    console.error("Erreur:", error);
                    alert("Erreur lors de l'envoi de la commande");
                });
        });

        // R√©initialiser le formulaire
        function resetForm() {
            document.getElementById('pizzaForm').reset();
            document.querySelectorAll('.choice-option').forEach(opt => opt.classList.remove('selected'));
            document.getElementById('successMessage').style.display = 'none';
            
            // Retour √† l'√©tape 1
            document.querySelectorAll('.form-step').forEach(step => step.classList.add('hidden'));
            document.querySelector('.form-step[data-step="1"]').classList.remove('hidden');
            
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active', 'completed');
            });
            document.querySelector('.step[data-step="1"]').classList.add('active');
            
            currentStep = 1;
            currentOrder = {};
        }

        // Fonctions Admin
        function requestAdminAccess() {
            document.getElementById('adminLogin').classList.add('show');
        }

        function checkPassword() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                isAdminAuthenticated = true;
                document.getElementById('adminLogin').classList.remove('show');
                document.getElementById('adminPassword').value = '';
                showAdminView();
            } else {
                alert('Mot de passe incorrect');
            }
        }

        function cancelLogin() {
            document.getElementById('adminLogin').classList.remove('show');
            document.getElementById('adminPassword').value = '';
        }

        function showOrderView() {
            document.getElementById('orderView').style.display = 'block';
            document.getElementById('adminView').style.display = 'none';
            document.getElementById('prepView').style.display = 'none';
        }

        function showAdminView() {
            if (!isAdminAuthenticated) {
                requestAdminAccess();
                return;
            }
            document.getElementById('orderView').style.display = 'none';
            document.getElementById('adminView').style.display = 'block';
            document.getElementById('prepView').style.display = 'none';
            loadOrders();
        }

        function showPrepView() {
            document.getElementById('orderView').style.display = 'none';
            document.getElementById('adminView').style.display = 'none';
            document.getElementById('prepView').style.display = 'block';
            loadPrepView();
        }

        // Charger les commandes
        function loadOrders() {
            db.collection("orders")
                .orderBy("timestamp", "asc")
                .onSnapshot((snapshot) => {
                    const orders = [];
                    snapshot.forEach((doc) => {
                        orders.push({ id: doc.id, ...doc.data() });
                    });
                    
                    document.getElementById('orderCount').textContent = orders.length;
                    displayOrders(orders);
                });
        }

        function displayOrders(orders) {
            const ordersList = document.getElementById('ordersList');
            
            if (orders.length === 0) {
                ordersList.innerHTML = '<p style="text-align: center; color: #999;">Aucune commande en attente</p>';
                return;
            }
            
            ordersList.innerHTML = orders.map((order, index) => `
                <div class="order-item">
                    <h3>Pizza #${index + 1} - ${order.name} - ${order.time || 'N/A'}</h3>
                    <div class="order-detail"><strong>P√¢te:</strong> ${order.dough}</div>
                    <div class="order-detail"><strong>Type:</strong> ${order.pizzaType}</div>
                    <div class="order-detail"><strong>Base:</strong> ${order.base}</div>
                    <div class="order-detail"><strong>L√©gumes:</strong> ${order.vegetables.join(', ') || 'Aucun'}</div>
                    <div class="order-detail"><strong>Fromages:</strong> ${order.cheese.join(', ') || 'Aucun'}</div>
                    <div class="order-detail"><strong>Viandes:</strong> ${order.meat.join(', ') || 'Aucune'}</div>
                    <div class="order-detail"><strong>Extras:</strong> ${order.extras.join(', ') || 'Aucun'}</div>
                    ${order.notes ? `<div class="order-detail"><strong>Notes:</strong> ${order.notes}</div>` : ''}
                    <button class="btn-danger" style="margin-top: 10px;" onclick="deleteOrder('${order.id}')">Supprimer</button>
                </div>
            `).join('');
        }

        // Supprimer une commande
        function deleteOrder(orderId) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer cette commande ?')) {
                db.collection("orders").doc(orderId).delete()
                    .catch(error => {
                        console.error("Erreur:", error);
                        alert("Erreur lors de la suppression");
                    });
            }
        }

        // Effacer toutes les commandes
        function clearOrders() {
            if (confirm('√ätes-vous s√ªr de vouloir effacer TOUTES les commandes ?')) {
                db.collection("orders").get().then(snapshot => {
                    const batch = db.batch();
                    snapshot.docs.forEach(doc => {
                        batch.delete(doc.ref);
                    });
                    return batch.commit();
                }).catch(error => {
                    console.error("Erreur:", error);
                    alert("Erreur lors de la suppression");
                });
            }
        }

        // Vue pr√©paration avec Firebase
        function loadPrepView() {
            db.collection("orders")
                .orderBy("timestamp", "asc")
                .get()
                .then(snapshot => {
                    const orders = [];
                    snapshot.forEach(doc => {
                        orders.push({ id: doc.id, ...doc.data() });
                    });
                    displayPrepMode(orders);
                });
        }

        function displayPrepMode(orders) {
            const prepContent = document.getElementById('prepContent');
            
            if (!orders || orders.length === 0) {
                prepContent.innerHTML = '<p style="text-align: center; color: #999;">Aucune commande √† pr√©parer</p>';
                return;
            }

            // Trier les commandes : sans gluten en premier
            orders.sort((a, b) => {
                if (a.dough === 'sans-gluten' && b.dough !== 'sans-gluten') return -1;
                if (a.dough !== 'sans-gluten' && b.dough === 'sans-gluten') return 1;
                return 0;
            });

            // Afficher d'abord le r√©sum√© des ingr√©dients
            const ingredientSummary = generateIngredientSummary(orders);
            const specialNotes = orders.filter(o => o.notes).map((o, idx) => 
                `<li><strong>${o.name} (Pizza #${orders.indexOf(o) + 1}):</strong> ${o.notes}</li>`
            ).join('');

            prepContent.innerHTML = `
                <div class="prep-instruction" style="margin-bottom: 20px;">
                    <h2>üìä R√©sum√© des ingr√©dients</h2>
                    <div style="text-align: left; margin: 15px 0;">
                        ${ingredientSummary}
                    </div>
                </div>
                ${specialNotes ? `
                <div class="prep-instruction" style="margin-bottom: 20px;">
                    <h2>üìù Instructions sp√©ciales</h2>
                    <ul style="text-align: left; margin: 15px 0;">
                        ${specialNotes}
                    </ul>
                </div>
                ` : ''}
                <button class="btn-primary" onclick="startPrepSteps()">Commencer la pr√©paration ‚Üí</button>
            `;
        }

        function generateIngredientSummary(orders) {
            const summary = {};
            
            // Compter les p√¢tes
            orders.forEach(order => {
                const doughName = order.dough === 'napolitaine' ? 'P√¢te Napolitaine' : 'P√¢te Sans gluten';
                summary[doughName] = (summary[doughName] || 0) + 1;
            });
            
            // Compter les bases
            orders.forEach(order => {
                const baseName = 'Base ' + getBaseName(order.base);
                summary[baseName] = (summary[baseName] || 0) + 1;
            });
            
            // Compter tous les autres ingr√©dients
            const categories = ['vegetables', 'cheese', 'meat', 'extras'];
            categories.forEach(cat => {
                orders.forEach(order => {
                    if (order[cat]) {
                        order[cat].forEach(ing => {
                            summary[ing] = (summary[ing] || 0) + 1;
                        });
                    }
                });
            });
            
            // Trier par quantit√© d√©croissante
            const sorted = Object.entries(summary).sort((a, b) => b[1] - a[1]);
            
            return sorted.map(([ing, count]) => 
                `<div style="margin: 5px 0;"><strong>${ing}:</strong> ${count}x</div>`
            ).join('');
        }

        function startPrepSteps() {
            db.collection("orders")
                .orderBy("timestamp", "asc")
                .get()
                .then(snapshot => {
                    const orders = [];
                    snapshot.forEach(doc => {
                        orders.push({ id: doc.id, ...doc.data() });
                    });
                    
                    // Trier les commandes
                    orders.sort((a, b) => {
                        if (a.dough === 'sans-gluten' && b.dough !== 'sans-gluten') return -1;
                        if (a.dough !== 'sans-gluten' && b.dough === 'sans-gluten') return 1;
                        return 0;
                    });
                    
                    const prepSteps = generatePrepSteps(orders);
                    let currentStepIndex = 0;

                    function showPrepStep() {
                        if (currentStepIndex >= prepSteps.length) {
                            document.getElementById('prepContent').innerHTML = `
                                <div class="prep-instruction">
                                    <h2>üéâ Toutes les pizzas sont pr√™tes !</h2>
                                    <button class="btn-primary" onclick="showAdminView()">Retour au tableau de bord</button>
                                </div>
                            `;
                            return;
                        }

                        const step = prepSteps[currentStepIndex];
                        const pizzasHtml = step.pizzas.map(p => {
                            const orderIndex = orders.indexOf(p) + 1;
                            return `
                                <div class="prep-pizza-item">
                                    <div class="prep-pizza-visual">
                                        <div class="pizza-layer show" style="font-size: 60px;">üçï</div>
                                    </div>
                                    <strong>${p.name} (#${orderIndex})</strong>
                                    ${p.dough === 'sans-gluten' ? '<div style="color: #e74c3c; font-size: 12px;">‚ö†Ô∏è Sans gluten</div>' : ''}
                                </div>
                            `;
                        }).join('');

                        document.getElementById('prepContent').innerHTML = `
                            <div class="prep-instruction">
                                <h3>√âtape ${currentStepIndex + 1} sur ${prepSteps.length}</h3>
                                <h2>${step.instruction}</h2>
                                <div class="prep-pizza-grid">${pizzasHtml}</div>
                                <button class="btn-primary" onclick="nextPrepStep()">Suivant ‚Üí</button>
                            </div>
                        `;
                    }

                    window.nextPrepStep = function() {
                        currentStepIndex++;
                        showPrepStep();
                    };

                    showPrepStep();
                });
        }

        function generatePrepSteps(orders) {
            const steps = [];
            
            // √âtape 1: P√¢tes
            const doughTypes = {};
            orders.forEach(order => {
                if (!doughTypes[order.dough]) doughTypes[order.dough] = [];
                doughTypes[order.dough].push(order);
            });
            
            // Toujours faire les sans gluten en premier
            if (doughTypes['sans-gluten']) {
                steps.push({
                    instruction: `‚ö†Ô∏è ATTENTION: Pr√©parer ${doughTypes['sans-gluten'].length} p√¢te(s) SANS GLUTEN (nettoyer le plan de travail)`,
                    pizzas: doughTypes['sans-gluten']
                });
            }
            
            if (doughTypes['napolitaine']) {
                steps.push({
                    instruction: `Pr√©parer ${doughTypes['napolitaine'].length} p√¢te(s) Napolitaine`,
                    pizzas: doughTypes['napolitaine']
                });
            }

            // √âtape 2: Bases
            const bases = {};
            orders.forEach(order => {
                if (!bases[order.base]) bases[order.base] = [];
                bases[order.base].push(order);
            });
            
            Object.entries(bases).forEach(([base, pizzas]) => {
                steps.push({
                    instruction: `√âtaler la base ${getBaseName(base)} sur ${pizzas.length} pizza(s)`,
                    pizzas: pizzas
                });
            });

            // √âtape 3: L√©gumes (du plus au moins utilis√©)
            const vegetables = countIngredients(orders, 'vegetables');
            vegetables.forEach(([veg, pizzas]) => {
                steps.push({
                    instruction: `Ajouter ${veg} sur ${pizzas.length} pizza(s)`,
                    pizzas: pizzas
                });
            });

            // √âtape 4: Fromages
            const cheeses = countIngredients(orders, 'cheese');
            cheeses.forEach(([cheese, pizzas]) => {
                steps.push({
                    instruction: `Ajouter ${cheese} sur ${pizzas.length} pizza(s)`,
                    pizzas: pizzas
                });
            });

            // √âtape 5: Viandes
            const meats = countIngredients(orders, 'meat');
            meats.forEach(([meat, pizzas]) => {
                steps.push({
                    instruction: `Ajouter ${meat} sur ${pizzas.length} pizza(s)`,
                    pizzas: pizzas
                });
            });

            // √âtape 6: Cuisson
            steps.push({
                instruction: `Enfourner toutes les pizzas (250¬∞C, 8-10 minutes)`,
                pizzas: orders
            });

            // √âtape 7: Extras
            const extras = countIngredients(orders, 'extras');
            extras.forEach(([extra, pizzas]) => {
                steps.push({
                    instruction: `Ajouter ${extra} sur ${pizzas.length} pizza(s) apr√®s cuisson`,
                    pizzas: pizzas
                });
            });

            return steps;
        }

        function countIngredients(orders, category) {
            const counts = {};
            
            orders.forEach(order => {
                if (order[category]) {
                    order[category].forEach(ingredient => {
                        if (!counts[ingredient]) counts[ingredient] = [];
                        counts[ingredient].push(order);
                    });
                }
            });
            
            return Object.entries(counts).sort((a, b) => b[1].length - a[1].length);
        }

        // Fonctions utilitaires
        function getPizzaName(type) {
            const names = {
                'personnalisee': 'Personnalis√©e',
                'margherita': 'Margherita',
                'regina': 'Regina',
                '4fromages': '4 Fromages',
                'calzone': 'Calzone',
                'diavola': 'Diavola'
            };
            return names[type] || type;
        }

        function getBaseName(base) {
            const names = {
                'tomate': 'Tomate',
                'creme': 'Cr√®me',
                'pesto': 'Pesto'
            };
            return names[base] || base;
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            showOrderView();
        });
    </script>
</body>
</html>
